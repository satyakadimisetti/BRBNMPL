<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bank Guarantee Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: rgb(255, 245, 238);
            margin: 0;
            padding: 30px 0;
        }

        .container {
            width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border: 1px solid rgb(255, 128, 0);
            border-radius: 6px;
        }

        h1 {
            color: rgb(255, 128, 0);
            text-align: center;
            margin-bottom: 20px;
        }

        .form-div {
            padding: 6px;
            margin: 0;
        }

        .form-left, .form-right {
            float: left;
            width: 46%;
            padding: 6px;
        }

        .cls {
            clear: both;
        }

        button {
            background: #ff8000;
            color: #fff;
            border: 1px solid red;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
            width: 10%;
            margin-top: 15px;
            margin-left: 10px;
        }

        .button:hover {
            background: #ff9900;
        }

        .btn-container {
            display: flex;
            margin-top: 20px;
        }

        .btn-back {
            background-color: #007bff;
            color: #fff;
            border: 1px solid blue;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
            width: 5%;
            margin-top: 15px;
            margin-left: 10px;
        }

        .btn-back:hover {
            background-color: #0056b3;
        }

        input, select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            box-sizing: border-box;
        }

        label {
            font-weight: bold;
        }

        .error {
            color: red;
            font-size: 14px;
            margin-top: 5px;
        }

        .success {
            color: green;
            font-size: 16px;
            margin-top: 10px;
            text-align: center;
        }

        .spinner {
            display: none;
            text-align: center;
        }

        .spinner img {
            width: 50px;
        }

        @media (max-width: 600px) {
            .form-group {
                flex-direction: column;
            }

            label, input, select {
                width: 100%;
            }
        }
    </style>
</head>

<body>

<div class="container">
    <h1>Bank Guarantee Form</h1>

    <form id="bgForm">

        <div class="form-div">
            <div class="form-left">
                <label>Entry Date:</label>
                <label for="entryDate"></label><input type="date" id="entryDate" required>
            </div>
            <div class="form-right">
                <label>BG Number:</label>
                <label for="bgNumber"></label><input type="text" id="bgNumber" required>
                <div class="error" id="bgNumberError"></div>
            </div>
            <div class="cls"></div>
        </div>

        <div class="form-div">
            <div class="form-left">
                <label>BG Date:</label>
                <label for="bgDate"></label><input type="date" id="bgDate" required>
            </div>
            <div class="form-right">
                <label>Type of BG:</label>
                <label for="typeOfBg"></label><select id="typeOfBg" required>
                <option value="">Select One</option>
                <option value="EMD">EMD</option>
                <option value="SD">SD</option>
            </select>
            </div>
            <div class="cls"></div>
        </div>

        <div class="form-div">
            <div class="form-left">
                <label for="vendor">Vendor:</label>
                <input type="text" id="vendor" name="vendor" required>
            </div>
            <div class="form-right">
                <label for="poWoNumber">PO/WO Number:</label>
                <input type="text" id="poWoNumber" name="poWoNumber" required>
            </div>
        </div>

        <div class="form-div">
            <div class="form-left">
                <label>PO/WO Date:</label>
                <label for="poWoDate"></label><input type="date" id="poWoDate" required>
            </div>
            <div class="form-right">
                <label>Nature of Supply:</label>
                <label for="natureOfSupply"></label><input type="text" id="natureOfSupply" required>
                <div class="error" id="natureOfSupplyError"></div>
            </div>
            <div class="cls"></div>
        </div>

        <div class="form-div">
            <div class="form-left">
                <label>Received Date:</label>
                <label for="receivedDate"></label><input type="date" id="receivedDate" required>
            </div>
            <div class="form-right">
                <label>Received From Dept:</label>
                <label for="receivedFromDept"></label><select id="receivedFromDept" required>
                <option value="">Select One</option>
                <option value="MMD">MMD</option>
                <option value="Civil Maint">Civil Maint</option>
                <option value="Utility Maint">Utility Maint</option>
                <option value="General Stores">General Stores</option>
                <option value="Others">Others</option>
            </select>
            </div>
            <div class="cls"></div>
        </div>

        <div class="form-div">
            <div class="form-left">
                <label>Bank Name:</label>
                <label for="bankName"></label><input type="text" id="bankName" required>
            </div>
            <div class="form-right">
                <label>Amount:</label>
                <label for="amount"></label><input type="text" id="amount" required>
                <div class="error" id="amountError"></div>
            </div>
            <div class="cls"></div>
        </div>

        <div class="form-div">
            <div class="form-left">
                <label>Currency:</label>
                <label for="currency"></label><select id="currency" required>
                <option value="">Select One</option>
                <option value="INR">INR</option>
                <option value="USD">USD</option>
                <option value="EURO">EURO</option>
                <option value="JPY">JPY</option>
            </select>
            </div>
            <div class="form-right">
                <label>Claim Date:</label>
                <label for="claimDate"></label><input type="date" id="claimDate" required>
            </div>
            <div class="cls"></div>
        </div>

        <div class="form-div">
            <div class="form-left">
                <label>Validity Date:</label>
                <label for="validityDate"></label><input type="date" id="validityDate" required>
            </div>
            <div class="cls"></div>
        </div>

        <div class="spinner" id="spinner">
            <img src="https://i.imgur.com/llF5iyg.gif" alt="Loading...">
        </div>

        <div class="btn-container">
            <button type="submit" onclick="submitForm(event)">Submit</button>
            <a href="/brbnmpl" class="btn btn-back">Back</a>
        </div>

        <div id="responseMessage" class="success"></div>

    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
    // Restricting future dates for date fields
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('entryDate').setAttribute('max', today);

    // Alphanumeric validation for multiple fields
    const alphaNumFields = ['bgNumber', 'vendor', 'poWoNumber', 'natureOfSupply'];

    alphaNumFields.forEach((fieldId) => {
        document.getElementById(fieldId).addEventListener('input', function () {
            this.value = this.value.replace(/[^a-zA-Z0-9]/g, '');
        });
    });

    // Amount validation (digits and single dot only)
    document.getElementById('amount').addEventListener('input', function () {
        this.value = this.value.replace(/[^0-9.]/g, '');
        const dotCount = (this.value.match(/\./g) || []).length;
        if (dotCount > 1) {
            this.value = this.value.slice(0, this.value.lastIndexOf('.'));
        }
    });

});
        // Form validation function before submission
        function validateForm() {
            const fields = document.querySelectorAll('input, select');

            for (const field of fields) {
                if (!field.value) {
                    alert(`Please fill in the ${field.name} field.`);
                    return false;
                }
            }
            return true;
        }
async function submitForm(event) {
event.preventDefault();

const formData = {
    entryDate: document.getElementById('entryDate').value,
    bgNumber: document.getElementById('bgNumber').value.replace(/[^a-zA-Z0-9]/g, ''),
    bgDate: document.getElementById('bgDate').value,
    typeOfBg: document.getElementById('typeOfBg').value,
    vendor: document.getElementById('vendor').value.replace(/[^a-zA-Z0-9]/g, ''),
    poWoNumber: document.getElementById('poWoNumber').value.replace(/[^a-zA-Z0-9]/g, ''),
    poWoDate: document.getElementById('poWoDate').value,
    natureOfSupply: document.getElementById('natureOfSupply').value.replace(/[^a-zA-Z0-9]/g, ''),
    receivedDate: document.getElementById('receivedDate').value,
    receivedFromDept: document.getElementById('receivedFromDept').value,
    bankName: document.getElementById('bankName').value,
    amount: document.getElementById('amount').value.replace(/[^0-9.]/g, ''),
    currency: document.getElementById('currency').value,
    claimDate: document.getElementById('claimDate').value,
    validityDate: document.getElementById('validityDate').value
};

const spinner = document.getElementById('spinner');
const responseMessage = document.getElementById('responseMessage');

spinner.style.display = 'block';

try {
    const response = await fetch('http://localhost:8086/api/bg/submit-form', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
    });

    spinner.style.display = 'none';

    responseMessage.innerHTML = response.ok ? 'Form submitted successfully!' : 'Failed to submit form!';
} catch (error) {
    responseMessage.innerHTML = 'Error occurred!';
    spinner.style.display = 'none';
}
}
</script>

</body>
</html>